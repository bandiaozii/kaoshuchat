(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-cosplay-chat"],{"15d4":function(t,a,e){"use strict";e("7a82");var i=e("4ea4").default;Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=i(e("c7eb")),o=i(e("1da1"));e("ac1f"),e("5319"),e("498a"),e("14d9"),e("d3b7"),e("e9c4"),e("8a79"),e("c975"),e("e25e");var s=i(e("44fb"));e("fd1e8"),e("279a"),e("a7eb"),e("40d3");var r=getApp(),c=[],d=0,l={components:{TextComponent:s.default},data:function(){return{pageIsLoad:!1,siteroot:"",lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,scrollTop:0,role:{},role_id:0,inputShow:!0}},onLoad:function(t){var a=this;t.role_id&&this.setData({role_id:t.role_id}),this.setData({system:r.globalData.system,siteroot:r.globalData.siteroot.replace("/web.php","")}),r.globalData.util.checkLogin().then((function(){a.getRole(),a.getHistoryMsg(),a.setData({pageIsLoad:!0})}))},methods:{sendText:function(){var t=this;return(0,o.default)((0,n.default)().mark((function a(){var e,i,o,s,l,u,f,g,p,b,v,m,h,x,w;return(0,n.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.writing){a.next=2;break}return a.abrupt("return");case 2:if(e=t.trim(t.message),e){a.next=12;break}if(!t.role.hint){a.next=9;break}t.message=t.role.hint,e=t.message,a.next=12;break;case 9:return r.globalData.util.message("请输入你的问题"),t.message="",a.abrupt("return");case 12:return d&&(clearInterval(d),d=0,c=[]),t.lists.push({user:"我",message:e}),t.message="",t.writing=!0,t.scrollToBottom(),i=new Headers,i.append("Content-Type","application/json"),i.append("X-site",uni.getStorageSync("sitecode")),o=t.siteroot+"/web.php/chat/sendText",s={role_id:t.role_id,message:e},a.next=24,fetch(o,{method:"POST",headers:i,body:JSON.stringify(s)});case 24:if(l=a.sent,l.ok){a.next=29;break}return t.writing=!1,r.globalData.util.message(l.statusText),a.abrupt("return");case 29:u=l.body.getReader(),f=new TextDecoder("utf-8"),g=!1,p="",d=setInterval((function(){c.length>0?(t.writingText+=c.shift(),t.scrollToBottom()):t.writing||(clearInterval(d),d=0,t.writingText&&t.lists.push({user:"AI",message:t.writingText}),t.writingText="",setTimeout((function(){t.scrollToBottom()}),200))}),50);case 34:if(g){a.next=55;break}return t.scrollToBottom(),a.next=38,u.read();case 38:if(b=a.sent,v=b.value,m=b.done,!v){a.next=52;break}if(h=f.decode(v),"\n"!==h||!p.endsWith("\n")){a.next=45;break}return a.abrupt("continue",34);case 45:if(!h){a.next=52;break}if(-1===h.indexOf("[error]")){a.next=50;break}if(x=function(){t.writing=!1,t.writingText="",t.lists.pop();var a=h.replace("[error]","");return-1!==a.indexOf("请登录")?(t.$emit("showlogin"),setTimeout((function(){r.globalData.util.message(a)}),500)):-1!==a.indexOf("请充值")?(t.$emit("showUserInfo"),setTimeout((function(){r.globalData.util.message(a)}),500)):r.globalData.util.message(a,"error"),"break"}(),"break"!==x){a.next=50;break}return a.abrupt("break",55);case 50:for(t.writing=!0,w=0;w<h.length;w++)c.push(h[w]);case 52:g=m,a.next=34;break;case 55:t.writing=!1;case 56:case"end":return a.stop()}}),a)})))()},sendConfirm:function(){var t=this;setTimeout((function(){t.sendText()}),50)},getHistoryMsg:function(){var t=this;r.globalData.util.request({url:"/cosplay/getHistoryMsg",data:{role_id:this.role_id,page:this.page,pagesize:this.pagesize}}).then((function(a){a.data.length>0&&t.setData({lists:a.data}),setTimeout((function(){t.scrollToBottom()}),300)}))},getRole:function(){var t=this;r.globalData.util.request({url:"/cosplay/getRole",data:{role_id:this.role_id}}).then((function(a){t.setData({role:a.data}),document.title=a.data.title}))},scrollToBottom:function(){var t=this;setTimeout((function(){var a=uni.createSelectorQuery().in(t);a.select(".list").boundingClientRect((function(a){t.setData({scrollTop:parseInt(a.height)})})),a.exec((function(t){}))}),200)},copyText:function(t){var a=document.createElement("textarea");a.value=t,a.readOnly="readOnly",a.style="width:0;height:0;",document.body.appendChild(a),a.select(),a.setSelectionRange(0,t.length),r.globalData.util.message("已复制"),document.execCommand("copy"),a.remove()},trim:function(t){return t?t.replace(/(^\s*)|(\s*$)/g,""):""}}};a.default=l},2881:function(t,a,e){"use strict";e.d(a,"b",(function(){return i})),e.d(a,"c",(function(){return n})),e.d(a,"a",(function(){}));var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-uni-view",{staticStyle:{height:"100%"}},[t.pageIsLoad?e("v-uni-view",{staticClass:"page"},[t.lists&&t.lists.length>0?e("v-uni-scroll-view",{staticClass:"box-msg-list",style:"bottom: "+(t.inputShow?"316rpx":"102rpx")+";",attrs:{"scroll-x":!1,"scroll-y":!0,"scroll-with-animation":!1,"scroll-top":t.scrollTop}},[e("v-uni-view",{staticClass:"list"},[t._l(t.lists,(function(a,i){return["AI"==a.user?e("v-uni-view",{key:i+"_0",staticClass:"message",staticStyle:{background:"#f7f7f8"},attrs:{"data-index":i}},[e("v-uni-view",{staticClass:"avatar"},[e("img",{attrs:{mode:"widthFix",src:"/static/img/ic_ai.png"}})]),e("v-uni-view",{staticClass:"text markdown-body"},[e("textComponent",{attrs:{text:a.message}}),e("v-uni-view",{staticStyle:{display:"block"}},[e("span",{staticClass:"btn-copy",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.copyText(a.message)}}},[t._v("复制内容")])])],1)],1):e("v-uni-view",{staticClass:"message",staticStyle:{background:"#fff"},attrs:{"data-index":i},on:{longpress:function(e){arguments[0]=e=t.$handleEvent(e),t.copyText(a.message)}}},[e("v-uni-view",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[e("img",{attrs:{mode:"widthFix",src:"/static/img/ic_user.png"}})]),e("v-uni-view",{staticClass:"text markdown-body"},[e("textComponent",{attrs:{text:a.message}})],1)],1)]})),t.writing||t.writingText?e("v-uni-view",{staticClass:"message",staticStyle:{background:"#f7f7f8"}},[e("v-uni-view",{staticClass:"avatar"},[e("img",{attrs:{src:"/static/img/ic_ai.png"}})]),e("v-uni-view",{staticClass:"text markdown-body"},[e("textComponent",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}})],1)],1):t._e()],2)],1):t._e(),e("v-uni-view",{staticClass:"box-input"},[e("v-uni-view",{staticClass:"input"},[e("v-uni-textarea",{attrs:{type:"text","confirm-type":"send","auto-height":!0,placeholder:t.role.hint||"输入你的问题",maxlength:"3000","cursor-spacing":"0"},on:{confirm:function(a){arguments[0]=a=t.$handleEvent(a),t.sendConfirm.apply(void 0,arguments)}},model:{value:t.message,callback:function(a){t.message=a},expression:"message"}}),e("v-uni-button",{staticClass:"btn-send",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.sendText.apply(void 0,arguments)}}},[e("v-uni-image",{attrs:{mode:"widthFix",src:"/static/images/ic_send.png"}})],1)],1)],1)],1):t._e()],1)},n=[]},"726a":function(t,a,e){var i=e("e7e4");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=e("4f06").default;n("796a059f",i,!0,{sourceMap:!1,shadowMode:!1})},"8fbe":function(t,a,e){"use strict";e.r(a);var i=e("2881"),n=e("cd93");for(var o in n)["default"].indexOf(o)<0&&function(t){e.d(a,t,(function(){return n[t]}))}(o);e("ab9b");var s=e("f0c5"),r=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"0aa2fa0c",null,!1,i["a"],void 0);a["default"]=r.exports},ab9b:function(t,a,e){"use strict";var i=e("726a"),n=e.n(i);n.a},cd93:function(t,a,e){"use strict";e.r(a);var i=e("15d4"),n=e.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){e.d(a,t,(function(){return i[t]}))}(o);a["default"]=n.a},e7e4:function(t,a,e){var i=e("24fb");a=i(!1),a.push([t.i,"uni-page-body[data-v-0aa2fa0c]{background:#f7f7f7}body.?%PAGE?%[data-v-0aa2fa0c]{background:#f7f7f7}.box-input[data-v-0aa2fa0c]{width:100%;padding:%?40?% 0;left:0;bottom:0;border-top:1px solid #d8d8e2;background:#f6f9fc}.box-input .input[data-v-0aa2fa0c]{width:%?690?%;margin:0 %?30?%;position:relative;box-sizing:border-box;box-shadow:0 0 %?12?% rgba(0,0,0,.1);background:#fefefe}.box-input .input uni-textarea[data-v-0aa2fa0c]{width:%?580?%;padding:%?20?% %?10?% %?20?% %?20?%;border-radius:%?10?%;line-height:%?40?%}.box-input .input .btn-send[data-v-0aa2fa0c]{position:absolute;right:0;bottom:0;width:%?100?%;height:%?80?%;padding:0;border:none;border-radius:%?10?%;background:none;display:flex;align-items:center;justify-content:center;z-index:9}.box-input .input .btn-send[data-v-0aa2fa0c]::after{display:none}.box-input .input .btn-send[data-v-0aa2fa0c]:active{background:#f2f2f2}.box-input .input .btn-send uni-image[data-v-0aa2fa0c]{width:%?40?%}.empty[data-v-0aa2fa0c]{text-align:center;margin:0 %?60?%;padding:%?80?% 0 %?100?% 0;margin-top:%?200?%;background:#fff;border-radius:%?20?%}.empty uni-image[data-v-0aa2fa0c]{width:%?404?%;height:%?266?%;margin-bottom:%?40?%}.empty .tip[data-v-0aa2fa0c]{width:100%;line-height:%?40?%;font-size:%?32?%;letter-spacing:%?2?%;color:#444}.btn-finish[data-v-0aa2fa0c]{width:60%;height:%?80?%;line-height:%?80?%;border-radius:%?48?%;border:none;color:#fff;margin:%?240?% auto 0 20%;box-shadow:0 0 %?20?% rgba(0,235,79,.1);font-size:%?30?%;letter-spacing:%?4?%;outline:none;background:#39b54a;text-align:center}.page[data-v-0aa2fa0c]{width:100%;overflow:hidden;display:flex;flex-direction:column;position:absolute;left:0;right:0;top:0;bottom:0;background:#fff}.box-msg-list[data-v-0aa2fa0c]{width:100%;height:100%;top:0;bottom:%?132?%;left:0;box-sizing:border-box;overflow:hidden}.list[data-v-0aa2fa0c]{width:100%;height:auto}.message[data-v-0aa2fa0c]{display:flex;justify-content:flex-start;padding:%?40?% %?40?%;border-bottom:%?2?% solid #eee}.message[data-v-0aa2fa0c]:last-child{border-bottom:0}.message .text[data-v-0aa2fa0c]{width:100%;color:#343541;line-height:%?52?%;font-size:%?32?%;word-break:break-all;padding:%?4?% 0;overflow:hidden}.message .text span[data-v-0aa2fa0c]{display:inline}.message .avatar[data-v-0aa2fa0c]{width:%?48?%;height:%?48?%;background:#10a37f;margin-right:%?30?%;color:#fff;font-size:%?28?%;border-radius:%?4?%;display:flex;align-items:center;justify-content:center;margin-top:%?6?%}.message .avatar uni-image[data-v-0aa2fa0c],\n.message .avatar img[data-v-0aa2fa0c]{width:%?36?%;height:%?36?%}.account[data-v-0aa2fa0c]{margin:%?20?% %?30?%;padding:%?16?% %?24?% %?16?% %?24?%;box-sizing:border-box;\n\t/* background: #f3f6f9; */border-radius:%?10?%;display:flex;justify-content:space-between;align-items:center}.account .balance[data-v-0aa2fa0c]{color:#666;font-size:%?24?%}.account .balance uni-text[data-v-0aa2fa0c]{color:#10a37f;margin-right:%?6?%}.account .btn-pay[data-v-0aa2fa0c]{display:inline-block;color:#10a37f;margin-left:%?20?%;font-size:%?24?%}.banner-ad[data-v-0aa2fa0c]{width:100%;height:%?120?%;border-top:%?2?% solid #ddd}.content[data-v-0aa2fa0c]{padding:%?20?%}.content uni-view[data-v-0aa2fa0c]{margin:%?10?% 0;word-break:break-all;line-height:1.5;font-size:%?28?%;color:#444}.content uni-image[data-v-0aa2fa0c]{width:100%}.btn-copy[data-v-0aa2fa0c]{color:#409eff}",""]),t.exports=a}}]);