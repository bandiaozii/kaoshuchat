(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60eec3aa"],{"0b77":function(t,e,a){},"24e3":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"433a":function(t,e,a){"use strict";a("0b77")},"4dfb7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"toolbar"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:t.clickCreate}},[t._v("生成卡密")]),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"240px"},attrs:{placeholder:"搜备注",size:"small",clearable:""},model:{value:t.search.keyword,callback:function(e){t.$set(t.search,"keyword",e)},expression:"search.keyword"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return t.doSearch()}},slot:"append"})],1)],1)],1),a("el-table",{attrs:{data:t.dataList,stripe:"",size:"medium","header-cell-class-name":"bg-gray"}},[a("el-table-column",{attrs:{prop:"id",label:"批次ID",width:"80"}}),a("el-table-column",{attrs:{prop:"create_time",label:"生成时间",width:"150"}}),a("el-table-column",{attrs:{prop:"num",label:"总数量",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"used",label:"已使用",width:"120",align:"center"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"220"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button-group",[a("el-button",{attrs:{type:"text",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),t.showCardList(e.row.id)}}},[a("i",{staticClass:"el-icon-view"}),t._v(" 查看 ")]),a("el-button",{attrs:{type:"text text-danger",size:"mini",icon:"el-icon-delete"},nativeOn:{click:function(a){return a.preventDefault(),t.clickDel(e.row.id)}}},[t._v("删除 ")])],1)]}}])})],1),a("el-pagination",{attrs:{"current-page":t.page,"page-size":t.pagesize,layout:"total, prev, pager, next",total:t.dataTotal},on:{"current-change":t.pageChange}}),t.form?a("div",[a("el-dialog",{attrs:{"custom-class":"my-dialog",title:"生成卡密",visible:!0,width:"500px","close-on-click-modal":!1,"before-close":t.closeForm}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"生成数量",prop:"num"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"1 - 2000",size:"small"},model:{value:t.form.num,callback:function(e){t.$set(t.form,"num",e)},expression:"form.num"}})],1),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticStyle:{width:"300px","max-width":"100%"},attrs:{type:"textarea",placeholder:"备注必填",size:"small"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeForm}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.doSubmit}},[t._v("提 交")])],1)],1)],1):t._e(),t.batch_id?a("batch-list",{attrs:{"batch-id":t.batch_id},on:{close:t.closeCardList}}):t._e()],1)},n=[],o=(a("592a"),a("85fa"),a("b775"));function r(t){return Object(o["a"])({url:"/card/getBatchList",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/card/createBatch",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/card/getBatchCard",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/card/batchDel",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/card/unbind",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/card/getBatchExport",method:"post",data:t})}var p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-drawer",{attrs:{title:"卡密管理",visible:t.dataList.length>0,direction:"rtl",size:"750px","close-on-click-modal":!1,"before-close":t.closeList},on:{"update:visible":function(e){return t.$set(t.dataList,"length > 0",e)}}},[a("div",{staticStyle:{padding:"0 20px"}},[a("div",{staticClass:"dialog-toolbar",staticStyle:{"padding-bottom":"20px"}},[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{loading:t.exportLoading,type:"primary",icon:"el-icon-download",size:"mini"},on:{click:t.doExport}},[t._v("导出Excel")]),a("el-checkbox",{model:{value:t.downUnbind,callback:function(e){t.downUnbind=e},expression:"downUnbind"}},[t._v("只导出未使用")])],1),a("el-table",{attrs:{data:t.dataList,stripe:"",size:"medium"}},[a("el-table-column",{attrs:{property:"id",label:"ID",width:"60"}}),a("el-table-column",{attrs:{property:"code",label:"卡密",width:"160"}}),a("el-table-column",{attrs:{property:"bind_time",label:"使用时间",width:"160"}}),a("el-table-column",{attrs:{label:"使用者",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.user_id?a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("img",{staticStyle:{height:"24px","margin-right":"5px"},attrs:{src:e.row.user.avatar}}),t._v(" "+t._s(e.row.user.nickname||"无昵称")+" [ID:"+t._s(e.row.user_id)+"] ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"操作",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.user_id?a("el-button",{attrs:{type:"text text-danger",size:"mini",icon:"el-icon-delete"},nativeOn:{click:function(a){return a.preventDefault(),t.unbind(e.row.id)}}},[t._v("设为未使用 ")]):t._e()]}}])})],1),a("el-pagination",{attrs:{"current-page":t.page,"page-size":t.pagesize,layout:"total, prev, pager, next",total:t.dataTotal},on:{"current-change":t.pageChange}})],1)])],1)},h=[],f=(a("f4e0"),a("72c9"),a("a7f3"),a("f144"),a("43c6"),{props:{batchId:{type:Number,default:0}},data:function(){return{dataList:null,dataTotal:0,page:1,pagesize:100,downUnbind:!1,exportLoading:!1}},mounted:function(){this.getList()},methods:{closeList:function(){var t=this;this.dataList=null,setTimeout((function(){t.$emit("close")}),200)},tableIndex:function(t){return this.pagesize*(this.page-1)+t+1},getList:function(){var t=this;l({batch_id:this.batchId,page:this.page,pagesize:this.pagesize}).then((function(e){t.dataList=e.data.list,t.dataTotal=e.data.count}))},pageChange:function(t){this.page=t,this.getList()},unbind:function(t){var e=this;this.$confirm("确认设为未使用吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u({id:t}).then((function(t){e.getList(),e.$message({message:t.message,type:"success",duration:1500})}))}))},doExport:function(){var t=this;this.exportLoading=!0,d({batch_id:this.batchId,unbind:this.downUnbind?1:0}).then((function(e){Promise.all([a.e("chunk-146d2888"),a.e("chunk-b845a9b6")]).then(a.bind(null,"4bf8")).then((function(a){var i="卡密["+t.batchId+"]",n=["ID","生成时间","卡密","使用时间","使用者ID"],o=["id","create_time","code","bind_time","user_id"],r=e.data,s=t.formatJson(o,r);a.export_json_to_excel({header:n,data:s,filename:i,autoWidth:!0,bookType:"xlsx"}),t.exportLoading=!1}))}))},formatJson:function(t,e){return e.map((function(e){return t.map((function(t){return e[t]}))}))}}}),m=f,b=(a("ca1b"),a("3427")),g=Object(b["a"])(m,p,h,!1,null,"58489174",null),v=g.exports,x={components:{batchList:v},data:function(){return{batch_id:0,form:null,search:{},agentList:null,dataList:[],dataTotal:0,page:1,pagesize:15,formRules:{num:[{required:!0,message:"此项必填",trigger:"blur"}],remark:[{required:!0,message:"此项必填",trigger:"blur"}]},cardListShow:!1}},created:function(){this.getBatchList()},methods:{getBatchList:function(){var t=this;r({page:this.page,pagesize:this.pagesize,keyword:this.search.keyword}).then((function(e){var a=e.data;t.dataList=a.list,t.dataTotal=e.data.count}))},tableIndex:function(t){return this.pagesize*(this.page-1)+t+1},pageChange:function(t){this.page=t,this.getBatchList()},clickCreate:function(){this.form={}},closeForm:function(){this.form=null},showCardList:function(t){this.batch_id=t,this.cardListShow=!0},closeCardList:function(){this.batch_id=0,this.cardListShow=!1},doSubmit:function(t){var e=this;this.$refs.form.validate((function(t){t&&s(e.form).then((function(t){e.page=1,e.getBatchList(),e.$message({message:t.message,type:"success",duration:1500}),e.closeForm()}))}))},clickDel:function(t){var e=this;this.$confirm("此操作将删除此批次的所有卡密","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){c({id:t}).then((function(t){t.errno?e.$message({message:t.message,type:"error"}):(e.getBatchList(),e.$message({message:t.message,type:"success",duration:1500}))}))}))},doSearch:function(){this.page=1,this.getBatchList()}}},w=x,y=(a("433a"),Object(b["a"])(w,i,n,!1,null,"16182f62",null));e["default"]=y.exports},"85fa":function(t,e,a){"use strict";var i=a("607c"),n=a("f65d"),o=a("a30c"),r=a("dc58"),s=a("f129"),l=a("24e3"),c=a("8fde"),u=a("a2f3"),d=a("ccba");n("search",(function(t,e,a){return[function(e){var a=s(this),n=r(e)?void 0:u(e,t);return n?i(n,e,a):new RegExp(e)[t](c(a))},function(t){var i=o(this),n=c(t),r=a(e,i,n);if(r.done)return r.value;var s=i.lastIndex;l(s,0)||(i.lastIndex=0);var u=d(i,n);return l(i.lastIndex,s)||(i.lastIndex=s),null===u?-1:u.index}]}))},ca1b:function(t,e,a){"use strict";a("e58f")},e58f:function(t,e,a){}}]);